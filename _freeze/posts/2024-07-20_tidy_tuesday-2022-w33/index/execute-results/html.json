{
  "hash": "2dec66723e573e961168f3cc59f202b0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Tidy Tuesday - 2020 - Week 33\"\ndescription: \"Moving an old Tidy Tuesday post to my new website\"\nauthor:\n  - name: Louis\ndate: 2024-07-20\ncategories: [Tidy Tuesday] \nformat:\n  html:\n    code-fold: true\n    code-tools: true\n---\n\n\nThis is an old Tidy Tuesday post that I am moving to this new website.\n\n# Preparation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(here)\nlibrary(tidyverse)\nlibrary(tvthemes)\nlibrary(extrafont)\n# extrafont::fonts()\nloadfonts(device = \"win\")\nimport_avatar()\n# library(devtools)\n# devtools::install_github(\"averyrobbins1/appa\")\nlibrary(appa)\n\navatar <- appa::appa\n\nscene_description2 <- avatar %>%\n  select(id, scene_description) %>%\n  unnest_longer(scene_description) %>%\n  filter(!is.na(scene_description))\n\nscene_description <- avatar %>%\n  filter(character == \"Scene Description\") %>%\n  select(-scene_description)\n\navatar <- avatar %>%\n  filter(character != \"Scene Description\") %>%\n  select(-scene_description)\n\n# split where paired (ex. Aang and Zuko)\ntosplit <- avatar %>%\n  filter(str_detect(character, \" and \")) %>%\n  separate_rows(character, sep = \" and \")\n\n# remove rows with \" and \" then add in split rows and order\navatar <- avatar %>%\n  filter(!str_detect(character, \" and \")) %>%\n  add_row(tosplit) %>%\n  arrange(id)\n\n\n# remove punctuation and count the number of words\navatar <- avatar %>%\n  mutate(\n    new_text = str_replace_all(character_words, \"[[:punct:]]+\", \" \"),\n    numwords = str_count(new_text, \"\\\\S+\")\n  )\n\n\n\n# get the top characters based on number of words spoken (could'a told ya these)\ntopchars <- avatar %>%\n  group_by(character) %>%\n  summarise(words = sum(numwords)) %>%\n  arrange(desc(words)) %>%\n  top_n(n = 7) %>%\n  ungroup()\n\n# count number of words\nwords <- avatar %>%\n  filter(character %in% topchars$character) %>%\n  group_by(book_num, chapter_num, character) %>%\n  summarise(words = sum(numwords)) %>%\n  arrange(book_num, chapter_num, desc(words)) %>%\n  ungroup() %>%\n  mutate(chap_num_pad = str_pad(chapter_num, 2, pad = \"0\")) %>%\n  select(-chapter_num) %>%\n  unite(\"episode\", c(book_num, chap_num_pad), sep = \".\") %>%\n  complete(episode, character) %>%\n  replace_na(list(words = 0)) %>%\n  group_by(character) %>%\n  mutate(cumsum_words = cumsum(words)) %>%\n  ungroup() %>%\n  mutate(book = rep(rep(levels(\n    factor(avatar$book)\n  ), times = c(20, 20, 21)), each = 7),\n  title = rep(levels(factor(avatar$chapter)), each = 7))\n```\n:::\n\n\n# Plotting\n\n\n::: {.cell}\n\n```{.r .cell-code}\nep_titles <- as.character(levels(factor(avatar$chapter)))\ndepth <- -6000\nmarjust <- -190\n\nplot <- ggplot(words,\n               aes(\n                 x = episode,\n                 y = cumsum_words,\n                 group = factor(character),\n                 color = factor(character)\n               )) +\n  annotate(\n    \"segment\",\n    x = 1, xend = 1,\n    y = 0, yend = 20000,\n    color = \"darkblue\",\n    linetype = \"dashed\"\n  ) +\n  annotate(\n    \"rect\",\n    xmin = 1, xmax = 20,\n    ymin = 0, ymax = 20000,\n    fill = \"lightblue\", alpha = 0.2\n  ) +\n  annotate(\n    \"text\",\n    x = 10, y = 20500,\n    label = \"Water\",\n    color = \"darkblue\",\n    family = \"Slayer\",\n    size = 6\n  ) +\n  annotate(\n    \"segment\",\n    x = 20, xend = 20,\n    y = depth, yend = 20000,\n    color = \"darkblue\",\n    linetype = \"dashed\"\n  ) +\n  annotate(\n    \"rect\",\n    xmin = 20, xmax = 40,\n    ymin = 0, ymax = 20000,\n    fill = \"lightgreen\", alpha = 0.2\n  ) +\n  annotate(\n    \"text\",\n    x = 30, y = 20500,\n    label = \"Earth\",\n    color = \"darkgreen\",\n    family = \"Slayer\",\n    size = 6\n  ) +\n  annotate(\n    \"segment\",\n    x = 40, xend = 40,\n    y = depth, yend = 20000,\n    color = \"darkgreen\",\n    linetype = \"dashed\"\n  ) +\n  annotate(\n    \"rect\",\n    xmin = 40, xmax = 61,\n    ymin = 0, ymax = 20000,\n    fill = \"lightcoral\", alpha = 0.2\n  ) +\n  annotate(\n    \"text\",\n    x = 50, y = 20500,\n    label = \"Fire\",\n    color = \"firebrick\",\n    family = \"Slayer\",\n    size = 6\n  ) +\n  annotate(\n    \"segment\",\n    x = 61, xend = 61,\n    y = depth, yend = 20000,\n    color = \"firebrick\",\n    linetype = \"dashed\"\n  ) +\n  geom_line(size = 1.2) +\n  annotate(\n    \"curve\",\n    x = 10, y = 17500,\n    xend = 22, yend = 9000,\n    curvature = 0.4,\n    arrow = arrow(length = unit(2, \"mm\")),\n    size = 1\n  ) +\n  annotate(\n    \"text\",\n    x = 17, y = 18000,\n    label = \"Generally Aang stays on top,\\n however...\",\n    color = \"black\",\n    family = \"Slayer\",\n    size = 3.5,\n    hjust = 0.5\n  ) +\n  annotate(\n    \"curve\",\n    x = 34, y = 16500,\n    xend = 60, yend = 19500,\n    curvature = -0.2,\n    arrow = arrow(length = unit(2, \"mm\")),\n    size = 1\n  ) +\n  annotate(\n    \"text\",\n    x = 26, y = 15000,\n    label = \"Sokka overtakes in the end.\\nThe show should be called \\nSokka: Warrior of the \\nSouthern Water Tribe.\",\n    color = \"black\",\n    family = \"Slayer\",\n    size = 3.5,\n    hjust = 0.5\n  ) +\n  annotate(\n    \"curve\",\n    x = 46, y = 6500,\n    xend = 50, yend = 5200,\n    curvature = -0.3,\n    arrow = arrow(length = unit(2, \"mm\")),\n    size = 1\n  ) +\n  annotate(\n    \"text\",\n    x = 36, y = 6500,\n    label = \"Zuko joins Team Avatar \\n and gets a bigger role.\",\n    color = \"black\",\n    family = \"Slayer\",\n    size = 3.5,\n    hjust = 0.5\n  ) +\n  scale_color_manual(values = c(\n    \"#ff9933\", \"#000000\", \"#7E605E\", \"#1DB4D3\",\n    \"#0047ab\", \"#015E05\", \"#FF4500\"\n  )) +\n  labs(\n    title = \"Avatar Jibber Jabber\",\n    subtitle = \"Who has the largest speaking role on Avatar: The Last Airbender?\",\n    color = \"Character\",\n    x = \"episode\",\n    y = \"Cumulative Words Spoken\",\n    caption = \"Data from appa::appa\\nVizualization by LM Penrod (@P_Louis2)\"\n  ) +\n  scale_x_discrete(labels = ep_titles) +\n  theme_avatar(\n    title.font = \"Slayer\",\n    legend.position = \"right\",\n    legend.font = \"Slayer\"\n  ) +\n  theme(\n    legend.key = element_blank(),\n    axis.text.x = element_text(\n      angle = 90, hjust = 1, vjust = -0.5,\n      margin = margin(t = marjust)\n    ),\n    axis.title.y = element_text(margin = margin(r = 10)),\n    panel.grid = element_line(color = \"transparent\"),\n    plot.title = element_text(hjust = 0.5, size = 18),\n    plot.subtitle = element_text(hjust = 0.5),\n    plot.caption = element_text(color = \"gray50\"),\n    axis.title = element_text(size = 12)\n  )\n\nggsave(\"ttY2020W33_1.png\",\n       plot = plot,\n       path = here(\"posts\",\"2024-07-20_tidy_tuesday-2022-w33\"),\n       width=10.5, height=11.5, \n       units=\"in\", dpi = 300)\n# export size: 1050widex900tall\n```\n:::\n\n\n# Final Figure\n\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::include_graphics(here(\"posts\",\"2024-07-20_tidy_tuesday-2022-w33\", \"ttY2020W33_1.png\"))\n```\n\n::: {.cell-output-display}\n![](ttY2020W33_1.png)\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}